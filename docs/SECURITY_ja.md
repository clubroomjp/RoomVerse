# セキュリティとプライバシー

RoomVerseは、分散型P2Pネットワークとして設計されており、セキュリティとプライバシーを最優先事項としています。本ドキュメントでは、実装されている主なセキュリティ対策について解説します。

## 1. ネットワークセキュリティ

### Cloudflare Tunnelによる保護
RoomVerseは外部からの接続を受け入れるために **Cloudflare Tunnel** を使用しています。
- **ポート開放不要**: 自宅ルーターのポートを開放したり、グローバルIPを公開する必要がありません。
- **DDoS保護**: Cloudflareのエッジネットワークが前段にあるため、基本的なDDoS攻撃から保護されます。
- **動的URL**: セッションごとにランダムなURL（`*.trycloudflare.com`）が発行されるため、ターゲットになりにくい構造です。

### Discovery Service (分散ディレクトリ)
- ディレクトリサーバー（Cloudflare D1）には、ルームの「現在のURL」と「基本情報（名前、定員）」のみが保存されます。
- 個人情報やチャットログは一切送信されません。

## 2. アプリケーションセキュリティ

### 入出力のサニタイズ (XSS対策)
RoomVerseは、訪問者からのメッセージおよびAIが生成したテキストのすべてに対して、厳格なサニタイズ処理（無害化）を行っています。
- **HTMLエスケープ**: `<script>` タグなどの悪意あるコードが含まれていても、すべてテキストとして扱われるようエスケープされます（例: `<` → `&lt;`）。
- これにより、チャット経由でのスクリプト実行（XSS攻撃）を防ぎます。

### 定員管理 (DoS対策)
- 各ルームには **最大同時接続数（Max Visitors）** が設定されています（デフォルト設定: 5人）。
- 設定数を超えた新たな訪問者は自動的に拒否されるため、サーバー（PC）への過負荷を防ぎます。

### API認証
- `config.json` の `security.api_key` を設定することで、特定のエージェントやユーザーのみにアクセスを制限することが可能です（未設定時はパブリック）。

## 3. プライバシーとデータ管理

### ローカル完結型アーキテクチャ
- **LLM**: 生成AI（LLM）はすべてローカル環境（あなたのPC内）で動作します。会話データが外部のAIプロバイダーに送信されることはありません。
- **ログデータ**: 会話履歴や訪問記録はローカルの `logs.sqlite` にのみ保存されます。

### 安全なバイナリ配布
- 配布される `RoomVerseNode.exe` には、署名された公式の `cloudflared` バイナリのみが含まれています。
